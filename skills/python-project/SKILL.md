---
name: python-project
description: Set up a modern Python project with uv, pyproject.toml, and ruff. Use when creating a new Python project, package, or CLI tool.
---

# Python Project Setup

Modern Python project setup using uv package manager and pyproject.toml.

## Creating a New Project

1. Create project directory and initialize git:
```bash
mkdir myproject && cd myproject
git init
```

2. Copy [pyproject.toml](pyproject.toml) and edit:
   - Change `name` to your project name
   - Update `description`
   - Add dependencies to `dependencies` list
   - Update `[project.scripts]` for CLI entry point

3. Copy [gitignore](gitignore) to `.gitignore`

4. Create package structure:
```bash
mkdir myproject
touch myproject/__init__.py
```

5. Initialize uv and install:
```bash
uv sync
```

## Project Structure

```
myproject/
├── myproject/
│   ├── __init__.py
│   ├── __main__.py      # For `python -m myproject`
│   └── cli.py           # CLI entry point
├── pyproject.toml
├── .gitignore
└── uv.lock              # Generated by uv
```

## Entry Points

### CLI script (installed as command)
```toml
[project.scripts]
myproject = "myproject.cli:main"
```

### __main__.py (for python -m)
```python
from myproject.cli import main

if __name__ == "__main__":
    main()
```

## Code Quality

Format and lint with ruff:
```bash
ruff format .
ruff check . --fix
```

## Type Annotations

Required for all new code:
```python
def greet(name: str) -> None:
    print(f"Hello, {name}")

def add(a: int, b: int) -> int:
    return a + b
```

Use Python 3.11+ built-in generics: `list[str]`, `dict[str, int]`, not `List`, `Dict`.

## Common Commands

```bash
uv sync              # Install dependencies
uv add requests      # Add dependency
uv run pytest        # Run tests
uv build             # Build package
```

## GitHub Actions: Publish to PyPI

### Setup Steps

1. Copy [publish.yml](publish.yml) to `.github/workflows/publish.yml`

2. Configure PyPI Trusted Publisher (no API tokens needed):
   - Go to https://pypi.org/manage/account/publishing/
   - Add new pending publisher:
     - PyPI project name: `myproject`
     - Owner: your GitHub username
     - Repository: your repo name
     - Workflow name: `publish.yml`
     - Environment: `pypi`

3. Create GitHub environment:
   - Go to repo Settings → Environments
   - Create environment named `pypi`

4. Release workflow:
   - Create a GitHub release with tag like `v0.1.0`
   - Action automatically extracts version from tag and publishes

### How Version is Set

The workflow extracts version from the git tag:
- Tag `v0.1.0` → version `0.1.0` in pyproject.toml
- The `v` prefix is stripped automatically
- No need to manually update version in pyproject.toml

### Publishing a Release

```bash
git tag v0.1.0
git push origin v0.1.0
```

Then create a release on GitHub from the tag, or use:
```bash
gh release create v0.1.0 --generate-notes
```
